<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.8"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>ETA/OS: Writing a driver</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="doxygen-bootstrap.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
		<div class="row">
		    <div class="col-sm-2 logo">
			<img alt="Logo" src="etaos-logo.svg"/>
		    </div>
		    <div class="col-sm-2 project-number">
                        <a class="navbar-brand">4.6.0</a>
		    </div>
	        </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Writing a driver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#driver-intro">Introduction</a></li>
<li class="level1"><a href="#modules">Drivers & modules</a><ul><li class="level2"><a href="#prep">Preparation</a></li>
<li class="level2"><a href="#setup">Setting up the driver module</a></li>
<li class="level2"><a href="#final">Final words</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="driver-intro"></a>
Introduction</h1>
<p>So, you have a chip on your hands that isn't supported by ETA/OS yet. How about you bring that support to us and write a driver for it.</p>
<p>This document will focus on the 'how to write a driver' part. Information on how this driver should be submitted to ETA/OS can be found in the generic contribution guide.</p>
<h1><a class="anchor" id="modules"></a>
Drivers &amp; modules</h1>
<p>Almost all drivers in ETA/OS are setup as modules. This means that they can be compiled, but are not neccessarily used by an application. This gives an application more flexibility when it comes to recompiling ETA/OS. Moreover, modules are automatically initialised so the user of a driver (or module) doesn't need to bother about calling complicated init functions.</p>
<h2><a class="anchor" id="prep"></a>
Preparation</h2>
<p>You should prepare yourself before you begin writing actual code. Make sure you have all related documents at hand such as:</p>
<ul>
<li>The datasheet for your MCU</li>
<li>The datasheet for the chip you are writing a driver for</li>
<li>This website for the ETA/OS API documentation</li>
</ul>
<p>Please note that we, at ETA/OS, like well designed code. So please think about that aswell: how are you going to design your driver? What interface is it going to get? Are you going to use a function based interface, like the GPIO driver, or is it better to use the VFS as interface (such as the EEPROM and SRAM drivers)?</p>
<h2><a class="anchor" id="setup"></a>
Setting up the driver module</h2>
<p>Every module in ETA/OS contains an init call, such as <code>module_init</code>. There are several of these and the only difference is order of execution. All available init calls, in order of execution are:</p>
<ul>
<li><code>subsys_init</code></li>
<li><code>module_init</code></li>
<li><code>device_init</code></li>
<li><code>chip_init</code></li>
</ul>
<p>Once you've decided which init call your driver needs you can setup the module:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> yourdrivername_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* Do nice init stuff here */</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__kern-init.html#ga3035e2f9c636eda870dd0cf2cf5ac6f3">module_init</a>(yourdrivername_init);</div>
</div><!-- fragment --><p>And.. that is it. That is all ETA/OS needs to know about your driver to properly initialise it.A</p>
<h2><a class="anchor" id="final"></a>
Final words</h2>
<p>Now you are ready to start writing code for your driver. For more information on the driver API you can take a look at the <a class="el" href="group__dev.html">device driver core</a> and the <a class="el" href="group__vfs.html">virtual file system</a>. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 1 2016 07:40:32 for ETA/OS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
